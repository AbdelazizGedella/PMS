<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Staff KPIs Dashboard</title>

  <!-- Import Firebase via CDN -->
  <script type="module">
    // Import Firebase modules (with modular approach)
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, doc } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";

    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyBlXR9-doF3ScNlKrec7wTVeejZ3dzEgb0",
      authDomain: "pms-ef53f.firebaseapp.com",
      projectId: "pms-ef53f",
      storageBucket: "pms-ef53f.appspot.com",
      messagingSenderId: "1097061442330",
      appId: "1:1097061442330:web:e2713a81ef3c8cce3c02a3",
      measurementId: "G-T4DP2JELKZ"
    };

    // Initialize Firebase and Firestore
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Function to Add New Staff
    window.addStaff = async () => {
      const staffId = document.getElementById('staffId').value;
      const staffName = document.getElementById('staffName').value;

      if (staffId && staffName) {
        try {
          // Add staff data to Firestore
          await addDoc(collection(db, "Staff"), {
            staffId: staffId,
            staffName: staffName
          });
          alert('Staff added successfully!');
          loadStaff();
        } catch (error) {
          console.error('Error adding staff: ', error);
        }
      } else {
        alert('Please fill out both Staff ID and Name.');
      }
    };

    // Function to Load Staff List from Firebase
    window.loadStaff = async () => {
      const staffTable = document.getElementById('staffTable');
      staffTable.innerHTML = ''; // Clear table before loading new data

      try {
        const querySnapshot = await getDocs(collection(db, "Staff"));
        querySnapshot.forEach((doc) => {
          const staffId = doc.id;
          const staffName = doc.data().staffName;

          // Add a new row to the table
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${staffId}</td>
            <td>${staffName}</td>
            <td>
              <button onclick="viewKPIs('${staffId}')">View KPIs</button>
            </td>
          `;
          staffTable.appendChild(row);
        });
      } catch (error) {
        console.error('Error loading staff: ', error);
      }
    };

    // Function to View KPI Details
    window.viewKPIs = async (staffId) => {
      const modal = document.getElementById('kpiModal');
      const modalStaffId = document.getElementById('modalStaffId');
      const kpiData = document.getElementById('kpiData');

      modalStaffId.textContent = staffId;
      kpiData.innerHTML = ''; // Clear previous data

      try {
        const querySnapshot = await getDocs(collection(doc(db, "Staff", staffId), "KPIs"));
        querySnapshot.forEach((doc) => {
          const data = doc.data();
          kpiData.innerHTML += `
            <p>Compliance to Licenses: ${data.complianceLicenses}%</p>
            <p>Non-Clinical Participation: ${data.nonClinicalParticipation}%</p>
            <p>Communication Skills: ${data.communicationSkills}</p>
            <p>Infection Control Compliance: ${data.infectionControlCompliance}%</p>
            <p>Document Accuracy: ${data.documentAccuracy}%</p>
            <p>Dress Code Compliance: ${data.dressCode}</p>
            <p>IPSG/ESR Compliance: ${data.ipsgCompliance}%</p>
            <p>Patient Care Compliance: ${data.careCompliance}%</p>
            <hr>
          `;
        });
      } catch (error) {
        console.error('Error loading KPIs: ', error);
      }

      modal.style.display = 'block';
    };

    // Close modal
    window.closeModal = () => {
      const modal = document.getElementById('kpiModal');
      modal.style.display = 'none';
    };

    // Load Staff List on Page Load
    window.onload = loadStaff;
  </script>

  <!-- Your previous CSS remains the same here -->

</head>

<body>
  <div class="container">
    <h1>Staff KPI Dashboard</h1>

    <!-- Form to Add New Staff -->
    <div class="form-container">
      <h2>Add New Staff</h2>
      <input type="text" id="staffId" placeholder="Staff ID" required>
      <input type="text" id="staffName" placeholder="Staff Name" required>
      <button onclick="addStaff()">Add Staff</button>
    </div>

    <!-- Table to Display Staff List -->
    <h2>Staff List</h2>
    <table>
      <thead>
        <tr>
          <th>Staff ID</th>
          <th>Staff Name</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="staffTable">
        <!-- Dynamic data will be inserted here -->
      </tbody>
    </table>
  </div>

  <!-- KPI Modal -->
  <div id="kpiModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal()">&times;</span>
      <h2>KPIs for Staff ID: <span id="modalStaffId"></span></h2>
      <div id="kpiData">
        <!-- KPI details will be displayed here -->
      </div>
    </div>
  </div>
</body>

</html>
